<div class="data-table-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th
            *ngFor="let column of columns; trackBy: trackByIndex"
            [style.width]="column.width"
            [class.text-center]="column.align === 'center'"
            [class.text-end]="column.align === 'right'"
            [class.sortable]="column.sortable"
            (click)="onSort(column)"
          >
            <div class="th-content">
              <span>{{ column.header }}</span>
              <span *ngIf="column.sortable" class="material-icons sort-icon">
                {{ getSortIcon(column) }}
              </span>
            </div>
          </th>
          <th *ngIf="showActions" class="text-center" style="width: 150px;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <!-- Empty State -->
        <tr *ngIf="!loading && data.length === 0">
          <td [attr.colspan]="columns.length + (showActions ? 1 : 0)" class="text-center py-5">
            <div class="empty-state">
              <span class="material-icons empty-icon">inbox</span>
              <p class="text-muted mb-0">{{ emptyMessage }}</p>
            </div>
          </td>
        </tr>

        <!-- Data Rows -->
        <tr *ngFor="let row of data; trackBy: trackByIndex">
          <td
            *ngFor="let column of columns; trackBy: trackByIndex"
            [class.text-center]="column.align === 'center'"
            [class.text-end]="column.align === 'right'"
          >
            <ng-container [ngSwitch]="column.type">
              <span *ngSwitchCase="'badge'"
                    class="badge"
                    [ngClass]="'bg-' + (row[column.field + '_color'] || 'secondary')">
                {{ getCellValue(row, column) }}
              </span>
              <span *ngSwitchDefault>{{ getCellValue(row, column) }}</span>
            </ng-container>
          </td>

          <!-- Action Buttons -->
          <td *ngIf="showActions" class="text-center">
            <div class="btn-group btn-group-sm" role="group">
              <button
                type="button"
                class="btn btn-outline-primary"
                (click)="onAction('view', row)"
                [title]="actionLabels.view"
              >
                <span class="material-icons">visibility</span>
              </button>
              <button
                type="button"
                class="btn btn-outline-warning"
                (click)="onAction('edit', row)"
                [title]="actionLabels.edit"
              >
                <span class="material-icons">edit</span>
              </button>
              <button
                type="button"
                class="btn btn-outline-danger"
                (click)="onAction('delete', row)"
                [title]="actionLabels.delete"
              >
                <span class="material-icons">delete</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav *ngIf="pagination && pagination.totalPages > 1" class="mt-3">
    <div class="d-flex justify-content-between align-items-center">
      <div class="text-muted">
        Mostrando {{ (pagination.currentPage - 1) * pagination.pageSize + 1 }}
        a {{ getItemsRangeEnd() }}
        de {{ pagination.totalItems }} registros
      </div>
      <ul class="pagination mb-0">
        <li class="page-item" [class.disabled]="pagination.currentPage === 1">
          <a class="page-link" (click)="onPageChange(pagination.currentPage - 1)">
            <span class="material-icons">chevron_left</span>
          </a>
        </li>

        <li
          *ngFor="let page of pageNumbers"
          class="page-item"
          [class.active]="page === pagination.currentPage"
          [class.disabled]="page === -1"
        >
          <a
            *ngIf="page !== -1"
            class="page-link"
            (click)="onPageChange(page)"
          >
            {{ page }}
          </a>
          <span *ngIf="page === -1" class="page-link">...</span>
        </li>

        <li class="page-item" [class.disabled]="pagination.currentPage === pagination.totalPages">
          <a class="page-link" (click)="onPageChange(pagination.currentPage + 1)">
            <span class="material-icons">chevron_right</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>
</div>
